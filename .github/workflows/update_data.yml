name: Update Trump Data
on:
  schedule:
    - cron: '*/30 * * * *' # Körs var 30:e minut
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v3

      - name: Calculate Intelligence Index
        run: |
          # Vi skapar en viktad simulering för "Inlägg senaste timmen"
          # Detta ger en mycket mer realistisk kurva för fakemake.se
          
          ROLL=$(( RANDOM % 100 ))
          
          if [ $ROLL -lt 60 ]; then
            # 60% chans för tystnad (0 inlägg)
            COUNT=0
            STATUS="calm"
          elif [ $ROLL -lt 85 ]; then
            # 25% chans för normal aktivitet (1-2 inlägg)
            COUNT=$(( ( RANDOM % 2 ) + 1 ))
            STATUS="normal"
          elif [ $ROLL -lt 95 ]; then
            # 10% chans för hög aktivitet (3-4 inlägg)
            COUNT=$(( ( RANDOM % 2 ) + 3 ))
            STATUS="high"
          else
            # 5% chans för TOTAL MELTDOWN (5-9 inlägg)
            COUNT=$(( ( RANDOM % 5 ) + 5 ))
            STATUS="meltdown"
          fi
          
          # Hämta tid och skapa JSON
          TIMESTAMP=$(date -u)
          echo "Simulering: $STATUS ($COUNT inlägg/h)"
          
          # Vi sparar detta som data.json
          # Notera: "status": "estimated" eftersom vi kör på vår algoritm
          echo "{\"postCount\": $COUNT, \"activityLevel\": \"$STATUS\", \"status\": \"estimated\", \"lastUpdated\": \"$TIMESTAMP\"}" > data.json

      - name: Commit and Push
        run: |
          git config user.name "github-actions"
          git config user.email "action@github.com"
          git add data.json
          git commit -m "Intelligence Update: $STATUS ($COUNT posts/h)" || exit 0
          git push
